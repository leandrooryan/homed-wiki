---
title: 'Modbus: Конфигурация'
---

# Modbus: Конфигурация

Конфигурация _HOMEd Modbus_ хранится в файле `/etc/homed/homed-modbus.conf`. Пример файла конфигурации:

```ini
[log]
enabled=false
timestamps=true
file=/var/log/homed.log

[mqtt]
host=localhost
port=1883
username=mqtt
password=mqtt
prefix=homed
instance=
names=false

[homeassistant]
enabled=false
prefix=homeassistant
status=homeassistant/status

[device]
database=/opt/homed-modbus/database.json

[port-1]
port=/dev/ttyS1
debug=false

[port-2]
port=/dev/ttyS2
debug=false
```

!!! info ""

    При изменении содержимого файла конфигурации сервис перезапускается автоматически.

## Параметры

#### `[log]`

| Параметр | Описание |
|----------|----------|
| `enabled`    | включение/выключение записи логов в файл |
| `timestamps` | включение/выключение меток времени при выводе лога в `stdout` |
| `file`       | путь к файлу лога |

#### `[mqtt]`

| Параметр | Описание |
|----------|----------|
| `host`     | адрес брокера |
| `port`     | порт брокера |
| `username` | имя пользователя для авторизации на брокере (может быть пустым) |
| `password` | пароль для авторизации на брокере (может быть пустым) |
| `prefix`   | корневой топик |
| `instance` | уникальное имя сервиса (может быть пустым), подробности [ниже](#_2) |
| `names`    | использование имен устройств вместо идентификаторов в MQTT-топиках |

#### `[homeassistant]`

| Параметр | Описание |
|----------|----------|
| `enabled` | включение/выключение функции [Home Assistant MQTT Discovery](https://www.home-assistant.io/integrations/mqtt/#mqtt-discovery) |
| `prefix`  | корневой топик для [Home Assistant MQTT Discovery](https://www.home-assistant.io/integrations/mqtt/#mqtt-discovery) |
| `status`  | топик для отслеживания [состояния Home Assistant](https://www.home-assistant.io/integrations/mqtt/#birth-and-last-will-messages) |

#### `[device]`

| Параметр | Описание |
|----------|----------|
| `database` | путь к файлу [базы данных](/modbus/database/) устройств |
| `expose`   | путь к файлу с [опциями](/common/options/) типовых [способностей](/common/exposes/) устройств |

#### `[port-N]`

| Параметр | Описание |
|----------|----------|
| `port`  | последовательный порт |
| `debug` | вывод в лог дампов обмена данными с устройствами |

!!! info ""

    Сервис может работать с неограниченным количествои последовательный портов, едиственным ограничением является произволительность хоста.

    Для каждого отдельного порта в файле конфигурации должна присутствовать отдельная секция с названием `[port-N]`, где `N` это уникальное целое число, которое, в дальнейшем, используется для настройки и идентификации устройств.

## Кластеризация

_HOMEd Modbus_ позволяет использовать несколько "инстансов" сервиса внутри одного корневого топика, это нужно, например, для централизованного управления всеми "инстансами" из одного [веб-интерфейса](/web/) или для организации перекрестных [автоматизаций](/automation/) между "инстансами".

Для корректной работы этих функций _необходимо_, чтобы у каждого "инстанса" было свое уникальное имя, при этом имя _одного_ из "инстансов" может быть пустым. Остальные сервисы устроены так, что смена уникальных имен для "инстансов" не должна влиять на их работу, однако не стоит забывать, что некоторые MQTT-топики сервисов публикуются с флагом __retain__, поэтому переименование "инстансов" без ручной зачистки таких топиков может привести к нежелательным последсвиям.

!!! warning ""

    Уникальное имя "инстанса" может быть строкой, состоящей из любых символов, за исключением спец-символов, используемых в MQTT-топиках: `#`, `+` и `/`.

    Тем не менее, во избежание потенциальных проблем, рекомендется использовать строки без пробелов, состоящие только из латинских букв и цифр, например: `guestHouse`.

## Что дальше?

После настройки _HOMEd Modbus_ можно приступать к добавлению устройств, при помощи [веб-интерфейса](/web/) или [вручную](/modbus/database/).
