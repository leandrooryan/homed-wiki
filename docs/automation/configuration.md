# Automation: Конфигурация

Конфигурация _HOMEd Automation_ хранится в файле `/etc/homed/homed-automation.conf`. Пример файла конфигурации:

```ini
[log]
enabled=false
timestamps=true
file=/var/log/homed.log

[mqtt]
host=localhost
port=1883
username=automation
password=secret
prefix=homed
instance=

[automation]
database=/opt/homed-automation/database.json

[location]
latitude=55.755864
longitude=37.617698

[telegram]
token=1234567890:abcdefghijklmnopqrstuvwxyz123456789
chat=123456789
update=true
timeout=60
```

!!! info ""
    При изменении содержимого файла конфигурации сервис перезапускается автоматически.

## Параметры

#### `[log]`

| <div style="width:150px">Параметр</div> | Описание |
|-----------------------------------------|----------|
| `enabled`    | включение/выключение записи логов в файл |
| `timestamps` | включение/выключение меток времени при выводе лога в `stdout` |
| `file`       | путь к файлу лога |

#### `[mqtt]`

| <div style="width:150px">Параметр</div> | Описание |
|-----------------------------------------|----------|
| `host`     | адрес брокера |
| `port`     | порт брокера |
| `username` | имя пользователя для авторизации на брокере (может быть пустым) |
| `password` | пароль для авторизации на брокере (может быть пустым) |
| `prefix`   | корневой топик |
| `instance` | уникальное имя сервиса (может быть пустым), подробности [ниже](#_2) |

#### `[automation]`

| <div style="width:150px">Параметр</div> | Описание |
|-----------------------------------------|----------|
| `database` | путь к файлу [базы данных](/automation/database/) автоматизаций|

#### `[location]`

| <div style="width:150px">Параметр</div> | Описание |
|-----------------------------------------|----------|
| `latitude`  | широта в градусах |
| `longitude` | долгота в градусах |

!!! info ""
    Данные о местоположении используются для расчета времени рассветов и закатов, а так же для функции адаптивного освещения.

#### `[telegram]`

| <div style="width:150px">Параметр</div> | Описание |
|-----------------------------------------|----------|
| `token`   | токен авторизации для [Telegram-бота](https://core.telegram.org/bots/api) |
| `chat`    | идентификатор _основного_ чата |
| `update`  | включение/выключение [поллинга](https://core.telegram.org/bots/api#getupdates) обновлений бота |
| `timeout` | таймаут получения обновлений бота |

!!! warning ""
    Для работы Telegram-бота необходимо, чтобы были настроены параметры `token` и `chat`. В случае, если один из этих параметров отсутствует в конфигурации, Telegram-бот работать не будет.

## Кластеризация

_HOMEd Automation_ позволяет использовать несколько "инстансов" сервиса внутри одного корневого топика. Это нужно, в первую очередь, для разделения задач по автоматизации между разными контроллерами с отдельными локальными "инстансами" сервисов, работающих с устройствами, а так же локальными MQTT-брокерами, объединенными MQTT-мостом.

Для корректной работы этих функций _необходимо_, чтобы у каждого "инстанса" было свое уникальное имя, при этом имя _одного_ из "инстансов" может быть пустым. Не стоит забывать, что некоторые MQTT-топики сервисов публикуются с флагом __retain__, поэтому переименование "инстансов" без ручной зачистки таких топиков может привести к нежелательным последсвиям.

!!! warning ""
    Уникальное имя "инстанса" может быть строкой, состоящей из любых символов, за исключением спец-символов, используемых в MQTT-топиках: `#`, `+` и `/`.

    Тем не менее, во избежание потенциальных проблем, рекомендется использовать строки без пробелов, состоящие только из латинских букв и цифр, например: `guestHouse`.

## Что дальше?

После настройки _HOMEd Automation_ можно приступать к добавлению автоматизаций в [базу данных](/automation/database/).
